\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{geometry}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{tcolorbox}
\usepackage{enumitem}
\usepackage{booktabs}
\usepackage{array}
\usepackage{multicol}

% Configuration de la page
\geometry{left=2cm,right=2cm,top=2.5cm,bottom=2.5cm}

% Configuration des couleurs
\definecolor{jupiterBlue}{RGB}{59, 130, 246}
\definecolor{solanaGreen}{RGB}{34, 197, 94}
\definecolor{deauraPurple}{RGB}{168, 85, 247}
\definecolor{codeGray}{RGB}{248, 250, 252}
\definecolor{warningOrange}{RGB}{251, 146, 60}

% Configuration des liens
\hypersetup{
    colorlinks=true,
    linkcolor=jupiterBlue,
    filecolor=jupiterBlue,
    urlcolor=jupiterBlue,
    citecolor=jupiterBlue
}

% Configuration des listings
\lstdefinestyle{typescript}{
    language=JavaScript,
    backgroundcolor=\color{codeGray},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    commentstyle=\color{solanaGreen},
    deletekeywords={...},
    escapeinside={\%*}{*)},
    extendedchars=true,
    frame=single,
    keepspaces=true,
    keywordstyle=\color{jupiterBlue},
    morekeywords={interface,type,const,let,async,await,export,import,from,as,extends,implements},
    numbers=left,
    numbersep=5pt,
    numberstyle=\tiny\color{gray},
    rulecolor=\color{black},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stepnumber=1,
    stringstyle=\color{deauraPurple},
    tabsize=2,
    title=\lstname
}

\lstdefinestyle{bash}{
    language=bash,
    backgroundcolor=\color{black!90},
    basicstyle=\ttfamily\footnotesize\color{white},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    commentstyle=\color{solanaGreen},
    frame=single,
    keepspaces=true,
    keywordstyle=\color{jupiterBlue},
    numbers=none,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stringstyle=\color{deauraPurple},
    tabsize=2
}

% Configuration des titres
\titleformat{\section}{\Large\bfseries\color{jupiterBlue}}{\thesection}{1em}{}
\titleformat{\subsection}{\large\bfseries\color{jupiterBlue}}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\normalsize\bfseries\color{jupiterBlue}}{\thesubsubsection}{1em}{}

% En-tête et pied de page
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\textcolor{jupiterBlue}{\textbf{Jupiter Swap DApp - Technical Documentation}}}
\fancyhead[R]{\textcolor{jupiterBlue}{\textbf{Next.js 14 + TypeScript}}}
\fancyfoot[C]{\thepage}

\begin{document}

% Page de titre
\begin{titlepage}
    \centering
    \vspace*{1.5cm}
    
    {\Huge\textbf{\textcolor{jupiterBlue}{Jupiter Swap DApp}}\par}
    \vspace{0.5cm}
    {\LARGE\textcolor{deauraPurple}{Technical Documentation \& README}\par}
    \vspace{0.3cm}
    {\Large\textit{Advanced SOL/USDC Trading Platform}\par}
    
    \vspace{1.5cm}
    
    \begin{tcolorbox}[colback=jupiterBlue!10,colframe=jupiterBlue,width=0.9\textwidth]
        \centering
        \textbf{🚀 Production-Ready DApp with Advanced Optimizations}\\
        \vspace{0.5cm}
        \begin{multicols}{2}
        \textbf{Framework:} Next.js 14 (App Router)\\
        \textbf{Language:} TypeScript 5.3+\\
        \textbf{Blockchain:} Solana Mainnet\\
        \textbf{API:} Jupiter v6\\
        \textbf{Styling:} Tailwind CSS + shadcn/ui\\
        \textbf{State:} Zustand + React Query\\
        \textbf{Testing:} Jest + Testing Library\\
        \textbf{Deployment:} Vercel + GitHub Actions
        \end{multicols}
    \end{tcolorbox}
    
    \vspace{1.5cm}
    
    \begin{tcolorbox}[colback=solanaGreen!10,colframe=solanaGreen,width=0.8\textwidth]
        \centering
        \textbf{🎯 Key Features}\\
        \vspace{0.3cm}
        ✅ Dynamic Slippage Optimization\\
        ✅ Smart Priority Fee Calculation\\
        ✅ MEV Protection Integration\\
        ✅ Multi-RPC Failover System\\
        ✅ Real-time Balance Tracking\\
        ✅ Comprehensive Error Handling\\
        ✅ Performance Monitoring (Sentry)\\
        ✅ Mobile-Responsive Design
    \end{tcolorbox}
    
    \vfill
    
    {\large\textbf{Developed by:} Kamel (\href{https://x.com/treizeb__}{@treizeb\_\_})\\
    \textbf{Company:} \href{https://deaura.io}{DeAura.io}\\
    \textbf{Period:} July 2025\par}
\end{titlepage}

\newpage
\tableofcontents
\newpage

\section{🚀 Quick Start}

\subsection{Prerequisites}

\begin{tcolorbox}[colback=warningOrange!10,colframe=warningOrange]
\textbf{Required Software:}
\begin{itemize}
    \item Node.js 18.17+ or 20.0+
    \item npm 9.0+ or yarn 1.22+ or pnpm 8.0+
    \item Git 2.30+
    \item A Solana wallet (Phantom, Solflare, etc.)
\end{itemize}
\end{tcolorbox}

\subsection{Installation}

\begin{lstlisting}[style=bash, caption=Installation Commands]
# Clone the repository
git clone https://github.com/deaura-io/jupiter-swap-nextjs.git
cd jupiter-swap-nextjs

# Install dependencies
npm install
# or
yarn install
# or
pnpm install

# Copy environment variables
cp .env.example .env.local

# Start development server
npm run dev
# or
yarn dev
# or
pnpm dev
\end{lstlisting}

\subsection{Environment Configuration}

\begin{lstlisting}[style=typescript, caption=Environment Variables (.env.local)]
# Application Configuration
NEXT_PUBLIC_APP_NAME="Jupiter Swap DApp"
NEXT_PUBLIC_APP_DESCRIPTION="Advanced SOL/USDC Trading Platform"
NEXT_PUBLIC_ENVIRONMENT="development"

# Solana Configuration
NEXT_PUBLIC_SOLANA_NETWORK="mainnet-beta"
NEXT_PUBLIC_RPC_URL="https://api.mainnet-beta.solana.com"

# API Keys (Production)
NEXT_PUBLIC_HELIUS_API_KEY="d94d81dd-f2a1-40f7-920d-0dfaf3aaf032"
NEXT_PUBLIC_ALCHEMY_API_KEY="UvOk23LRlqGz1m58VCEd3PJ2ZOX2h9KM"

# RPC Endpoints with Failover
NEXT_PUBLIC_FALLBACK_RPC_URLS='[
  "https://eclipse.helius-rpc.com/",
  "https://api.mainnet-beta.solana.com",
  "https://solana-api.projectserum.com"
]'

# Jupiter API Configuration
NEXT_PUBLIC_JUPITER_API_BASE="https://quote-api.jup.ag"
NEXT_PUBLIC_JUPITER_API_VERSION="v6"

# Optimization Settings
NEXT_PUBLIC_ENABLE_OPTIMIZATIONS="true"
NEXT_PUBLIC_DEFAULT_SLIPPAGE_BPS="50"
NEXT_PUBLIC_MAX_SLIPPAGE_BPS="300"
NEXT_PUBLIC_ENABLE_MEV_PROTECTION="true"

# Fee Recovery Configuration
NEXT_PUBLIC_ENABLE_FEE_RECOVERY="true"
NEXT_PUBLIC_FEE_RECOVERY_PERCENTAGE="25"
NEXT_PUBLIC_SERVICE_WALLET="DeAura1234567890123456789012345678901234"

# Monitoring & Analytics
NEXT_PUBLIC_SENTRY_DSN="your_sentry_dsn_here"
NEXT_PUBLIC_ENABLE_ANALYTICS="true"

# Development Settings
NEXT_PUBLIC_ENABLE_DEVTOOLS="true"
NEXT_PUBLIC_LOG_LEVEL="info"
\end{lstlisting}

\section{🏗️ Architecture Overview}

\subsection{Project Structure}

\begin{lstlisting}[style=bash, caption=Project Directory Structure]
jupiter-swap-nextjs/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── layout.tsx         # Root layout
│   │   ├── page.tsx           # Home page
│   │   ├── privacy/           # Privacy policy
│   │   ├── terms/             # Terms of service
│   │   └── api/               # API routes
│   ├── components/            # React components
│   │   ├── swap/              # Swap-related components
│   │   ├── wallet/            # Wallet components
│   │   ├── ui/                # shadcn/ui components
│   │   ├── layout/            # Layout components
│   │   ├── analytics/         # Analytics components
│   │   └── providers/         # Context providers
│   ├── services/              # Business logic
│   │   ├── jupiter.ts         # Jupiter API integration
│   │   ├── solana.ts          # Solana blockchain
│   │   ├── swap.ts            # Swap orchestration
│   │   ├── optimization.ts    # Trading optimizations
│   │   ├── rpc-manager.ts     # RPC management
│   │   ├── errors.ts          # Error handling
│   │   └── feeRecovery.ts     # Fee recovery logic
│   ├── hooks/                 # Custom React hooks
│   ├── store/                 # Zustand stores
│   ├── types/                 # TypeScript definitions
│   ├── utils/                 # Utility functions
│   ├── constants/             # Application constants
│   └── styles/                # Global styles
├── public/                    # Static assets
├── docs/                      # Documentation
├── tests/                     # Test files
└── config files               # Configuration files
\end{lstlisting}

\subsection{Technology Stack}

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|l|}
\hline
\textbf{Category} & \textbf{Technology} & \textbf{Version} & \textbf{Purpose} \\
\hline
\multirow{3}{*}{Frontend} & Next.js & 14.2.0 & React framework \\
& TypeScript & 5.3+ & Type safety \\
& Tailwind CSS & 3.4.0 & Styling \\
\hline
\multirow{4}{*}{Blockchain} & @solana/web3.js & 1.91.4 & Solana integration \\
& @solana/spl-token & 0.4.1 & Token operations \\
& @jup-ag/react-hook & 6.2.0 & Jupiter integration \\
& Wallet Adapter & 0.15.35 & Wallet connection \\
\hline
\multirow{3}{*}{State} & Zustand & 4.5.0 & State management \\
& React Query & 5.28.14 & Server state \\
& React Hook Form & 7.51.0 & Form handling \\
\hline
\multirow{3}{*}{UI/UX} & Radix UI & Latest & Headless components \\
& Lucide React & Latest & Icons \\
& Framer Motion & 11.0.0 & Animations \\
\hline
\multirow{3}{*}{Testing} & Jest & 29.7.0 & Unit testing \\
& Testing Library & 14.2.0 & Component testing \\
& Playwright & 1.42.0 & E2E testing \\
\hline
\multirow{2}{*}{DevOps} & ESLint & 8.57.0 & Code linting \\
& Prettier & 3.2.0 & Code formatting \\
\hline
\end{tabular}
\caption{Complete Technology Stack}
\end{table}

\section{🔧 Core Services}

\subsection{Jupiter Service Integration}

\begin{lstlisting}[style=typescript, caption=Jupiter API Service Implementation]
/**
 * Jupiter API v6 Integration Service
 * Handles quote fetching, swap transactions, and route optimization
 */
export class JupiterService {
  private readonly apiBase: string;
  private readonly version: string;
  
  constructor() {
    this.apiBase = process.env.NEXT_PUBLIC_JUPITER_API_BASE!;
    this.version = process.env.NEXT_PUBLIC_JUPITER_API_VERSION!;
  }

  /**
   * Fetch optimized quote for token swap
   * @param params - Quote parameters
   * @returns Promise<JupiterQuote>
   */
  async getQuote(params: QuoteParams): Promise<JupiterQuote> {
    const queryParams = new URLSearchParams({
      inputMint: params.inputMint,
      outputMint: params.outputMint,
      amount: params.amount.toString(),
      slippageBps: params.slippageBps?.toString() || '50',
      feeBps: params.feeBps?.toString() || '0',
      onlyDirectRoutes: params.onlyDirectRoutes?.toString() || 'false',
      asLegacyTransaction: 'false',
      platformFeeBps: '25', // 0.25% platform fee
      maxAccounts: '64',
    });

    const response = await fetch(
      `${this.apiBase}/${this.version}/quote?${queryParams}`,
      {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json',
        },
      }
    );

    if (!response.ok) {
      throw new JupiterApiError(
        `Quote request failed: ${response.status}`,
        response.status
      );
    }

    return response.json();
  }

  /**
   * Get swap transaction for execution
   * @param quoteResponse - Quote from getQuote()
   * @param userPublicKey - User's wallet public key
   * @param options - Additional swap options
   * @returns Promise<SwapTransaction>
   */
  async getSwapTransaction(
    quoteResponse: JupiterQuote,
    userPublicKey: PublicKey,
    options: SwapOptions = {}
  ): Promise<SwapTransaction> {
    const swapRequest = {
      quoteResponse,
      userPublicKey: userPublicKey.toString(),
      wrapAndUnwrapSol: true,
      useSharedAccounts: true,
      feeAccount: options.feeAccount,
      trackingAccount: options.trackingAccount,
      computeUnitPriceMicroLamports: options.priorityFee || 'auto',
      asLegacyTransaction: false,
      useTokenLedger: false,
      destinationTokenAccount: options.destinationTokenAccount,
    };

    const response = await fetch(`${this.apiBase}/${this.version}/swap`, {
      method: 'POST',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(swapRequest),
    });

    if (!response.ok) {
      throw new JupiterApiError(
        `Swap transaction request failed: ${response.status}`,
        response.status
      );
    }

    return response.json();
  }
}
\end{lstlisting}

\subsection{Optimization Service}

\begin{lstlisting}[style=typescript, caption=Advanced Trading Optimizations]
/**
 * Trading Optimization Service
 * Implements dynamic slippage, smart priority fees, and MEV protection
 */
export class OptimizationService {
  private readonly coingeckoService: CoingeckoService;
  private readonly rpcManager: RpcManager;

  constructor(
    coingeckoService: CoingeckoService,
    rpcManager: RpcManager
  ) {
    this.coingeckoService = coingeckoService;
    this.rpcManager = rpcManager;
  }

  /**
   * Calculate dynamic slippage based on market conditions
   * @param inputToken - Input token information
   * @param outputToken - Output token information  
   * @param tradeSize - Trade size in USD
   * @returns Optimized slippage in basis points
   */
  async calculateDynamicSlippage(
    inputToken: Token,
    outputToken: Token,
    tradeSize: number
  ): Promise<number> {
    try {
      // Get market data for both tokens
      const [inputMarketData, outputMarketData] = await Promise.all([
        this.coingeckoService.getTokenMarketData(inputToken.coingeckoId),
        this.coingeckoService.getTokenMarketData(outputToken.coingeckoId),
      ]);

      // Base slippage (0.5%)
      const baseSlippage = 50;

      // Volatility factor (based on 24h price change)
      const inputVolatility = Math.abs(inputMarketData.price_change_percentage_24h || 0);
      const outputVolatility = Math.abs(outputMarketData.price_change_percentage_24h || 0);
      const avgVolatility = (inputVolatility + outputVolatility) / 2;
      
      const volatilityFactor = Math.min(2.0, Math.max(0.8, 1.0 + (avgVolatility / 100)));

      // Trade size factor (larger trades need more slippage)
      const sizeFactor = Math.min(1.5, 1.0 + Math.log10(tradeSize / 1000) * 0.1);

      // Liquidity factor (based on 24h volume)
      const avgVolume = (inputMarketData.total_volume + outputMarketData.total_volume) / 2;
      const liquidityFactor = Math.min(1.3, Math.max(0.7, 1.0 - Math.log10(avgVolume / 1000000) * 0.1));

      // Calculate dynamic slippage
      const dynamicSlippage = Math.round(
        baseSlippage * volatilityFactor * sizeFactor * liquidityFactor
      );

      // Ensure slippage is within reasonable bounds (0.1% to 3%)
      return Math.min(300, Math.max(10, dynamicSlippage));
    } catch (error) {
      console.warn('Failed to calculate dynamic slippage, using default:', error);
      return 50; // Default 0.5%
    }
  }

  /**
   * Calculate smart priority fee based on network conditions
   * @param urgency - Transaction urgency level
   * @returns Priority fee in microLamports
   */
  async calculateSmartPriorityFee(
    urgency: 'low' | 'medium' | 'high' = 'medium'
  ): Promise<number> {
    try {
      const connection = this.rpcManager.getConnection();
      
      // Get recent prioritization fees
      const recentFees = await connection.getRecentPrioritizationFees({
        lockedWritableAccounts: [
          new PublicKey('11111111111111111111111111111112'), // System Program
          new PublicKey('TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA'), // Token Program
        ],
      });

      if (recentFees.length === 0) {
        return this.getDefaultPriorityFee(urgency);
      }

      // Calculate percentiles
      const fees = recentFees.map(fee => fee.prioritizationFee).sort((a, b) => a - b);
      const p50 = fees[Math.floor(fees.length * 0.5)];
      const p75 = fees[Math.floor(fees.length * 0.75)];
      const p90 = fees[Math.floor(fees.length * 0.9)];

      // Select fee based on urgency
      let targetFee: number;
      switch (urgency) {
        case 'low':
          targetFee = p50;
          break;
        case 'medium':
          targetFee = p75;
          break;
        case 'high':
          targetFee = p90;
          break;
      }

      // Apply bounds and return
      return Math.min(100000, Math.max(1000, targetFee));
    } catch (error) {
      console.warn('Failed to calculate smart priority fee, using default:', error);
      return this.getDefaultPriorityFee(urgency);
    }
  }

  private getDefaultPriorityFee(urgency: 'low' | 'medium' | 'high'): number {
    const defaultFees = {
      low: 1000,    // 0.001 SOL
      medium: 5000, // 0.005 SOL  
      high: 10000,  // 0.01 SOL
    };
    return defaultFees[urgency];
  }
}
\end{lstlisting}

\section{🔐 Security & Error Handling}

\subsection{Comprehensive Error Management}

\begin{lstlisting}[style=typescript, caption=Typed Error System]
/**
 * Custom Error Classes for Jupiter Swap DApp
 * Provides detailed error information for better debugging and user experience
 */

export class JupiterSwapError extends Error {
  public readonly code: string;
  public readonly context?: Record<string, any>;
  public readonly timestamp: Date;

  constructor(message: string, code: string, context?: Record<string, any>) {
    super(message);
    this.name = 'JupiterSwapError';
    this.code = code;
    this.context = context;
    this.timestamp = new Date();
  }
}

export class WalletError extends JupiterSwapError {
  constructor(message: string, context?: Record<string, any>) {
    super(message, 'WALLET_ERROR', context);
    this.name = 'WalletError';
  }
}

export class TransactionError extends JupiterSwapError {
  public readonly signature?: string;
  
  constructor(message: string, signature?: string, context?: Record<string, any>) {
    super(message, 'TRANSACTION_ERROR', context);
    this.name = 'TransactionError';
    this.signature = signature;
  }
}

export class JupiterApiError extends JupiterSwapError {
  public readonly statusCode?: number;
  
  constructor(message: string, statusCode?: number, context?: Record<string, any>) {
    super(message, 'JUPITER_API_ERROR', context);
    this.name = 'JupiterApiError';
    this.statusCode = statusCode;
  }
}

export class RpcError extends JupiterSwapError {
  public readonly endpoint?: string;
  
  constructor(message: string, endpoint?: string, context?: Record<string, any>) {
    super(message, 'RPC_ERROR', context);
    this.name = 'RpcError';
    this.endpoint = endpoint;
  }
}

/**
 * Error Handler Utility
 * Centralized error processing and logging
 */
export class ErrorHandler {
  static handle(error: unknown, context?: string): JupiterSwapError {
    // Log error to console and Sentry
    console.error(`[${context || 'Unknown'}] Error:`, error);
    
    if (typeof window !== 'undefined' && window.Sentry) {
      window.Sentry.captureException(error, {
        tags: { context },
        extra: { timestamp: new Date().toISOString() }
      });
    }

    // Convert to typed error
    if (error instanceof JupiterSwapError) {
      return error;
    }

    if (error instanceof Error) {
      return new JupiterSwapError(
        error.message,
        'UNKNOWN_ERROR',
        { originalError: error.name, context }
      );
    }

    return new JupiterSwapError(
      'An unknown error occurred',
      'UNKNOWN_ERROR',
      { originalError: String(error), context }
    );
  }
}
\end{lstlisting}

\section{🧪 Testing Strategy}

\subsection{Test Configuration}

\begin{lstlisting}[style=typescript, caption=Jest Configuration with Mocks]
// jest.config.js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  roots: ['<rootDir>/src'],
  transform: {
    '^.+\\.tsx?$': ['ts-jest', {
      tsconfig: 'tsconfig.test.json',
    }],
  },
  moduleNameMapper: {
    '^@/(.*)$': '<rootDir>/src/$1',
    '^@/components/(.*)$': '<rootDir>/src/components/$1',
    '^@/services/(.*)$': '<rootDir>/src/services/$1',
    '^@/hooks/(.*)$': '<rootDir>/src/hooks/$1',
    '^@/store/(.*)$': '<rootDir>/src/store/$1',
    '^@/types/(.*)$': '<rootDir>/src/types/$1',
    '^@/utils/(.*)$': '<rootDir>/src/utils/$1',
    '^@/constants$': '<rootDir>/src/constants/index.ts',
  },
  setupFilesAfterEnv: ['<rootDir>/src/__tests__/setup.ts'],
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
    '!src/**/__mocks__/**',
    '!src/**/__tests__/**',
  ],
  coverageThreshold: {
    global: {
      branches: 70,
      functions: 70,
      lines: 70,
      statements: 70,
    },
  },
};
\end{lstlisting}

\subsection{Test Examples}

\begin{lstlisting}[style=typescript, caption=Service Unit Tests]
// src/services/__tests__/swap.test.ts
import { SwapService } from '../swap';
import { JupiterService } from '../jupiter';
import { OptimizationService } from '../optimization';

describe('SwapService', () => {
  let swapService: SwapService;
  let mockJupiterService: jest.Mocked<JupiterService>;
  let mockOptimizationService: jest.Mocked<OptimizationService>;

  beforeEach(() => {
    mockJupiterService = {
      getQuote: jest.fn(),
      getSwapTransaction: jest.fn(),
    } as any;

    mockOptimizationService = {
      calculateDynamicSlippage: jest.fn(),
      calculateSmartPriorityFee: jest.fn(),
    } as any;

    swapService = new SwapService(
      mockJupiterService,
      mockOptimizationService
    );
  });

  describe('executeSwap', () => {
    it('should execute swap with optimizations', async () => {
      // Mock responses
      mockOptimizationService.calculateDynamicSlippage.mockResolvedValue(75);
      mockOptimizationService.calculateSmartPriorityFee.mockResolvedValue(5000);
      
      mockJupiterService.getQuote.mockResolvedValue({
        inputMint: 'So11111111111111111111111111111111111111112',
        outputMint: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v',
        inAmount: '1000000000',
        outAmount: '180500000',
        slippageBps: 75,
        routePlan: [],
      });

      mockJupiterService.getSwapTransaction.mockResolvedValue({
        swapTransaction: 'base64_transaction_data',
        lastValidBlockHeight: 123456789,
      });

      const result = await swapService.executeSwap({
        inputToken: SOL_TOKEN,
        outputToken: USDC_TOKEN,
        inputAmount: 1.0,
        userPublicKey: new PublicKey('11111111111111111111111111111112'),
        enableOptimizations: true,
      });

      expect(result.success).toBe(true);
      expect(mockOptimizationService.calculateDynamicSlippage).toHaveBeenCalled();
      expect(mockOptimizationService.calculateSmartPriorityFee).toHaveBeenCalled();
    });

    it('should handle swap errors gracefully', async () => {
      mockJupiterService.getQuote.mockRejectedValue(
        new Error('Insufficient liquidity')
      );

      await expect(
        swapService.executeSwap({
          inputToken: SOL_TOKEN,
          outputToken: USDC_TOKEN,
          inputAmount: 1000000, // Unrealistic amount
          userPublicKey: new PublicKey('11111111111111111111111111111112'),
        })
      ).rejects.toThrow('Insufficient liquidity');
    });
  });
});
\end{lstlisting}

\section{📊 Performance Optimization}

\subsection{Bundle Optimization}

\begin{lstlisting}[style=typescript, caption=Next.js Configuration for Performance]
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  // Enable experimental features
  experimental: {
    optimizePackageImports: ['@radix-ui/react-icons', 'lucide-react'],
    turbo: {
      rules: {
        '*.svg': {
          loaders: ['@svgr/webpack'],
          as: '*.js',
        },
      },
    },
  },

  // Webpack optimizations
  webpack: (config, { dev, isServer }) => {
    // Optimize bundle splitting
    if (!dev && !isServer) {
      config.optimization.splitChunks = {
        chunks: 'all',
        cacheGroups: {
          solana: {
            name: 'solana-vendors',
            test: /[\\/]node_modules[\\/](@solana|@jup-ag)[\\/]/,
            priority: 10,
            reuseExistingChunk: true,
          },
          ui: {
            name: 'ui-vendors',
            test: /[\\/]node_modules[\\/](@radix-ui|lucide-react)[\\/]/,
            priority: 9,
            reuseExistingChunk: true,
          },
          default: {
            minChunks: 2,
            priority: -10,
            reuseExistingChunk: true,
          },
        },
      };
    }

    // Resolve fallbacks for Node.js modules
    config.resolve.fallback = {
      ...config.resolve.fallback,
      crypto: require.resolve('crypto-browserify'),
      stream: require.resolve('stream-browserify'),
      buffer: require.resolve('buffer'),
    };

    return config;
  },

  // Image optimization
  images: {
    domains: ['raw.githubusercontent.com'],
    formats: ['image/webp', 'image/avif'],
  },

  // Security headers
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
          {
            key: 'Referrer-Policy',
            value: 'strict-origin-when-cross-origin',
          },
          {
            key: 'Content-Security-Policy',
            value: "default-src 'self'; script-src 'self' 'unsafe-eval' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https:",
          },
        ],
      },
    ];
  },
};

module.exports = nextConfig;
\end{lstlisting}

\section{🚀 Deployment Guide}

\subsection{Production Deployment}

\begin{lstlisting}[style=bash, caption=Production Build and Deployment]
# Build for production
npm run build

# Test production build locally
npm run start

# Deploy to Vercel
vercel --prod

# Or deploy with GitHub Actions
git push origin main
\end{lstlisting}

\subsection{Environment-Specific Configurations}

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|l|}
\hline
\textbf{Environment} & \textbf{Network} & \textbf{RPC} & \textbf{Features} \\
\hline
Development & Devnet & Local/Devnet & All features + devtools \\
\hline
Staging & Devnet & Helius Devnet & Production simulation \\
\hline
Production & Mainnet & Helius + Alchemy & Full production \\
\hline
\end{tabular}
\caption{Environment Configurations}
\end{table}

\section{📚 API Reference}

\subsection{Core Hooks}

\begin{lstlisting}[style=typescript, caption=Custom React Hooks]
/**
 * useSwap Hook - Main swap functionality
 */
export function useSwap() {
  const {
    inputToken,
    outputToken,
    inputAmount,
    outputAmount,
    quote,
    isLoading,
    error,
    setInputToken,
    setOutputToken,
    setInputAmount,
    fetchQuote,
    executeSwap,
    reset,
  } = useSwapStore();

  const { publicKey, connected } = useWallet();

  // Auto-fetch quote when parameters change
  useEffect(() => {
    if (inputToken && outputToken && inputAmount && connected && publicKey) {
      const debounceTimer = setTimeout(() => {
        fetchQuote(publicKey);
      }, 500);
      
      return () => clearTimeout(debounceTimer);
    }
  }, [inputToken, outputToken, inputAmount, connected, publicKey]);

  return {
    // State
    inputToken,
    outputToken,
    inputAmount,
    outputAmount,
    quote,
    isLoading,
    error,
    canSwap: connected && inputToken && outputToken && inputAmount && quote,
    
    // Actions
    setInputToken,
    setOutputToken,
    setInputAmount,
    executeSwap: () => executeSwap(publicKey!),
    reset,
  };
}

/**
 * useOptimization Hook - Trading optimizations
 */
export function useOptimization() {
  const {
    optimizationsEnabled,
    dynamicSlippage,
    smartPriorityFee,
    mevProtection,
    toggleOptimizations,
    updateSlippage,
    updatePriorityFee,
  } = useOptimizationStore();

  return {
    // State
    optimizationsEnabled,
    dynamicSlippage,
    smartPriorityFee,
    mevProtection,
    
    // Actions
    toggleOptimizations,
    updateSlippage,
    updatePriorityFee,
  };
}
\end{lstlisting}

\section{🔍 Troubleshooting}

\subsection{Common Issues}

\begin{tcolorbox}[colback=warningOrange!10,colframe=warningOrange]
\textbf{Issue: "Transaction signature verification failure"}
\begin{itemize}
    \item \textbf{Cause:} RPC endpoint issues or network congestion
    \item \textbf{Solution:} Check RPC configuration, try different endpoint
    \item \textbf{Code:} Verify \texttt{NEXT\_PUBLIC\_HELIUS\_API\_KEY} is valid
\end{itemize}
\end{tcolorbox}

\begin{tcolorbox}[colback=warningOrange!10,colframe=warningOrange]
\textbf{Issue: "Insufficient SOL for transaction"}
\begin{itemize}
    \item \textbf{Cause:} Not enough SOL for transaction fees
    \item \textbf{Solution:} Ensure wallet has at least 0.01 SOL for fees
    \item \textbf{Prevention:} Implement balance checks before swap
\end{itemize}
\end{tcolorbox}

\begin{tcolorbox}[colback=warningOrange!10,colframe=warningOrange]
\textbf{Issue: "Slippage tolerance exceeded"}
\begin{itemize}
    \item \textbf{Cause:} High market volatility or large trade size
    \item \textbf{Solution:} Increase slippage tolerance or reduce trade size
    \item \textbf{Feature:} Dynamic slippage optimization helps prevent this
\end{itemize}
\end{tcolorbox}

\subsection{Debug Commands}

\begin{lstlisting}[style=bash, caption=Debugging Commands]
# Check build issues
npm run build 2>&1 | tee build.log

# Run tests with coverage
npm run test:coverage

# Lint and fix issues
npm run lint:fix

# Type checking
npm run type-check

# Analyze bundle size
npm run analyze

# Check for security vulnerabilities
npm audit

# Update dependencies
npm update --save
\end{lstlisting}

\section{🤝 Contributing}

\subsection{Development Workflow}

\begin{lstlisting}[style=bash, caption=Development Workflow]
# 1. Fork and clone the repository
git clone https://github.com/your-username/jupiter-swap-nextjs.git
cd jupiter-swap-nextjs

# 2. Create a feature branch
git checkout -b feature/your-feature-name

# 3. Install dependencies
npm install

# 4. Make your changes
# ... code changes ...

# 5. Run tests
npm run test

# 6. Run linting
npm run lint:fix

# 7. Commit changes
git add .
git commit -m "feat: add your feature description"

# 8. Push to your fork
git push origin feature/your-feature-name

# 9. Create a Pull Request
# Open GitHub and create a PR from your fork
\end{lstlisting}

\subsection{Code Standards}

\begin{itemize}
    \item \textbf{TypeScript:} Strict mode enabled, no \texttt{any} types
    \item \textbf{ESLint:} Airbnb configuration with custom rules
    \item \textbf{Prettier:} Automatic code formatting
    \item \textbf{Husky:} Pre-commit hooks for quality checks
    \item \textbf{Conventional Commits:} Standardized commit messages
\end{itemize}

\section{📄 License \& Credits}

\subsection{License}

This project is licensed under the MIT License. See the \texttt{LICENSE} file for details.

\subsection{Credits}

\begin{itemize}
    \item \textbf{Developer:} Kamel (\href{https://x.com/treizeb__}{@treizeb\_\_})
    \item \textbf{Company:} \href{https://deaura.io}{DeAura.io}
    \item \textbf{Jupiter Protocol:} \href{https://jup.ag}{Jupiter Exchange}
    \item \textbf{Solana Foundation:} \href{https://solana.org}{Solana Blockchain}
    \item \textbf{Vercel:} \href{https://vercel.com}{Deployment Platform}
\end{itemize}

\subsection{Acknowledgments}

Special thanks to the Jupiter team for their excellent API documentation and the Solana community for their continuous support and innovation in the DeFi space.

\vspace{1cm}

\begin{center}
\textit{Built with ❤️ for the Solana ecosystem}\\
\textit{DeAura.io - July 2025}
\end{center}

\end{document}

